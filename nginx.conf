 events {
     worker_connections 1024;
 }

 http {
     # Increase buffer sizes for better performance
     client_max_body_size 10M;
     proxy_buffer_size 128k;
     proxy_buffers 4 256k;
     proxy_busy_buffers_size 256k;

     # Timeout settings
     proxy_connect_timeout 600;
     proxy_send_timeout 600;
     proxy_read_timeout 600;
     send_timeout 600;

     # === BASE SERVICE ===
     upstream base-api {
         server base-api-prod:8080;
     }

     # === FORMATTER SERVICE ===
     upstream formatter-api {
         server formatter-service-api-prod:8080;
     }

     # === SNIPPET SERVICE ===
     upstream snippet-api {
         server snippet-service-api-prod:8080;
     }

     # === EXECUTION SERVICE ===
     upstream execution-api {
         server execution-service-api-prod:8080;
     }

     # === ANALYZER SERVICE ===
     upstream analyzer-api {
         server analyzer-service-api-prod:8080;
     }

     # === AUTHORIZATION SERVICE ===
     upstream authorization-api {
         server authorization-service-api-prod:8080;
     }

     # === AUTHENTICATION SERVICE ===
     upstream authentication-api {
         server authentication-service-api-prod:8080;
     }

     server {
         listen 80;
         server_name _;

         # Health check endpoint
         location /health {
             access_log off;
             return 200 "Nginx is running\n";
             add_header Content-Type text/plain;
         }

         # === BASE API (port 8000) ===
         location /api/base/ {
             proxy_pass http://base-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === FORMATTER SERVICE (port 8001) ===
         location /api/formatter/ {
             proxy_pass http://formatter-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === SNIPPET SERVICE (port 8002) ===
         location /api/snippet/ {
             proxy_pass http://snippet-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === EXECUTION SERVICE (port 8003) ===
         location /api/execution/ {
             proxy_pass http://execution-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === ANALYZER SERVICE (port 8004) ===
         location /api/analyzer/ {
             proxy_pass http://analyzer-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === AUTHORIZATION SERVICE (port 8005) ===
         location /api/authorization/ {
             proxy_pass http://authorization-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # === AUTHENTICATION SERVICE (port 8006) ===
         location /api/auth/ {
             proxy_pass http://authentication-api/;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header X-Forwarded-Proto $scheme;
         }

         # Default location
         location / {
             return 200 "PNG-Provisioner API Gateway\n\nAvailable services:\n- /api/base/\n- /api/formatter/\n- /api/snippet/\n- /api/execution/\n- /api/analyzer/\n- /api/authorization/\n- /api/auth/\n";
             add_header Content-Type text/plain;
         }
     }
 }